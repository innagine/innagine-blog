---
id: js-rubbish
title: 垃圾回收机制
# hide_title: false
# hide_table_of_contents: false
# sidebar_label: Markdown :)
description: javascript中的垃圾回收机制
keywords:
  - js
  - frontend
---



![在这里插入图片描述](https://img-blog.csdnimg.cn/20210111114152347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ltYWdpbmVfdGlvbg==,size_16,color_FFFFFF,t_70#pic_center)


### 一、什么是内存泄漏？

程序的运行需要内存，当程序提出要求，操作系统就会供给内存。对于不再用到的内存，没有及时释放，就叫做**内存泄漏**。

对于持续运行的服务进程，必须及时释放内存，否则，内存占用越来越高，轻则影响系统性能，重则导致进程崩溃。



### 二、什么是垃圾回收机制?

 JavaScript具有垃圾收集器，垃圾收集器会按照固定的时间间隔周期性的执行。

最常见的垃圾回收方式有两种：

- 标记清除
- 引用计数



#### 1.标记清除：

原理：是当变量进入环境时，将这个变量标记为“进入环境”。当变量离开环境时，则将其标记为“离开环境”。标记“离开环境”的就回收内存。

1.  垃圾回收器，在运行的时候会给存储在内存中的所有变量都加上标记。
2.  去掉环境中的变量以及被环境中的变量引用的变量的标记。
3.  再被加上标记的会被视为准备删除的变量。
4.  垃圾回收器完成内存清除工作，销毁那些带标记的值并回收他们所占用的内存空间。



#### 2.引用计数

原理：跟踪记录每个值被引用的次数。

1. 声明了一个变量并将一个引用类型的值赋值给这个变量，这个引用类型值的引用次数就是1。
2. 同一个值又被赋值给另一个变量，这个引用类型值的引用次数加1。
3. 当包含这个引用类型值的变量又被赋值成另一个值了，那么这个引用类型值的引用次数减1。
4. 当引用次数变成0时，说明没办法访问这个值了。
5. 当垃圾收集器下一次运行时，它就会释放引用次数是0的值所占的内存。

（注意：当循环引用的时候就会释放不掉内存。）



### 三、如何观察内存泄漏？

如果连续五次垃圾回收之后，内存占用一次比一次大，就有内存泄漏。这就要求实时查看内存占用。

1. 可以浏览器查看内存占用。
2. 通过命令行，命令行可以使用 Node `process.memoryUsage`提供的方法。`process.memoryUsage`返回一个对象，包含了 Node 进程的内存占用信息。（判断内存泄漏，以`heapUsed`字段为准。）



### 四、总结

内存没有释放或释放及时会造成内存泄漏。

垃圾回收机制的常用方式是标记清除和引用计数。

查看内存泄漏可以通过浏览器和命令行的方式。



